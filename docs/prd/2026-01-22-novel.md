# Novel - AI 小说创作助手 PRD

**创建日期**: 2026-01-22
**版本**: v1.0
**状态**: Draft

---

## 1. 项目概述

### 1.1 项目背景

用户阅读过大量网文小说,希望利用 AI 技术创作自己的小说。现有 AI 工具(ChatGPT/Claude)在生成长篇小说时存在严重的长期一致性问题,导致生成的内容质量不佳。

### 1.2 目标用户

- 个人用户(作者本人)
- 有丰富的网文阅读经验
- 想用 AI 辅助创作高质量网文

### 1.3 核心价值

**解决 AI 长篇小说创作的长期一致性问题,生成质量不错的 50 万字网文。**

---

## 2. 核心问题 (第一性原理分析)

### 2.1 要解决的根本问题

**AI 在生成长篇小说时的长期记忆和一致性问题**

具体表现:
- **伏笔遗忘**: 第 1 章埋的伏笔,第 200 章时 AI 已经忘记
- **人物状态混乱**: 第 1 章死的人,第 200 章又活了(没有复活情节)
- **世界观矛盾**: 前后设定不一致,规则自相矛盾

根本原因:
- AI 上下文窗口有限
- 即使有长上下文,也容易"遗忘"早期细节
- 缺少结构化的记忆系统

### 2.2 被质疑的假设

- **假设 1**: "一次性生成 50 万字" → **结论**: 放弃(质量无法保证,改为分章节生成)
- **假设 2**: "完全由 AI 生成,无需人工干预" → **结论**: 放弃(需要交互式创作和审核)
- **假设 3**: "只要有长上下文就能保持一致性" → **结论**: 放弃(需要结构化记忆系统)
- **假设 4**: "短篇小说是 50 万字" → **结论**: 修正(50 万字是长篇,短篇是 1-5 万字)

### 2.3 真正的约束

- **技术约束**:
  - AI 上下文窗口有限(需要向量数据库)
  - 需要结构化记忆系统(人物卡、伏笔列表、世界观设定)

- **业务约束**:
  - 目标是 50 万字长篇小说
  - 分章节生成(每章 3000 字左右)
  - 质量要达到"网文"标准(剧情连贯、人物一致、有爽点)

- **资源约束**:
  - 个人项目,单人使用
  - Web 应用,方便访问

---

## 3. 功能需求

### 3.1 MVP (最小可行产品)

**目标**: 验证"带记忆系统的 AI 小说创作"能否解决一致性问题

#### 功能列表

- [ ] **交互式设定创建**
  - 描述: 用户提供初始点子,AI 通过提问完善人物、世界观、剧情大纲
  - 优先级: P0 (必须有)
  - 输出: 结构化的小说设定文档

- [ ] **分章节生成**
  - 描述: 根据大纲和记忆系统,每次生成一章(3000 字左右)
  - 优先级: P0 (必须有)
  - 输入: 当前章节大纲 + 记忆系统
  - 输出: 新章节内容

- [ ] **毒舌编辑审核**
  - 描述: AI 扮演"起点毒舌编辑",检查新章节与记忆系统的一致性
  - 优先级: P0 (必须有)
  - 检查项: 人物状态、伏笔、世界观设定、剧情逻辑
  - 输出: 问题列表和修改建议

- [ ] **记忆系统管理**
  - 描述: 查看和编辑人物卡、伏笔列表、世界观设定
  - 优先级: P0 (必须有)
  - 功能: CRUD 操作,搜索,版本历史

### 3.2 完整版

**目标**: 提供完整的创作体验

#### 功能列表

- [ ] **章节修订**
  - 描述: 根据编辑建议修改章节
  - 优先级: P1 (重要但非必须)

- [ ] **多版本管理**
  - 描述: 保存章节的多个版本,支持回滚
  - 优先级: P1 (重要但非必须)

- [ ] **导出功能**
  - 描述: 导出为 TXT/EPUB/PDF 格式
  - 优先级: P2 (可以延后)

- [ ] **统计分析**
  - 描述: 字数统计、章节进度、人物出场频率等
  - 优先级: P2 (可以延后)

---

## 4. 验收标准 (VDD)

### 4.1 功能验证清单

#### MVP 验收标准

- [ ] 用户可以通过对话创建完整的小说设定(人物、世界观、大纲)
- [ ] 系统能够生成一章 3000 字左右的内容
- [ ] 毒舌编辑能够检测出明显的一致性问题(如死人复活)
- [ ] 用户可以查看和编辑记忆系统中的所有内容
- [ ] 生成 10 章后,人物状态和世界观仍然保持一致
- [ ] 页面加载时间 < 3s
- [ ] 支持 Chrome/Safari/Firefox 最新版本

#### 完整版验收标准

- [ ] 用户可以修改章节并重新生成
- [ ] 系统能够保存章节的多个版本
- [ ] 用户可以导出完整小说为 TXT 格式

### 4.2 自动化验证

#### E2E 测试 (Playwright)

```typescript
// 核心流程测试
test('完整创作流程', async ({ page }) => {
  // 1. 创建设定
  await page.goto('/');
  await page.click('text=新建小说');
  await page.fill('[name="idea"]', '修仙世界的程序员');
  await page.click('text=开始创作');

  // 2. 生成第一章
  await page.click('text=生成章节');
  await page.waitForSelector('text=第一章');

  // 3. 编辑审核
  await page.click('text=审核');
  await expect(page.locator('.review-result')).toBeVisible();

  // 4. 查看记忆系统
  await page.click('text=记忆系统');
  await expect(page.locator('.character-card')).toHaveCount(1);
});
```

#### 手动验证清单

- [ ] 在 Chrome 中测试完整创作流程
- [ ] 测试生成 10 章后的一致性
- [ ] 测试边界情况(空输入、超长输入、特殊字符)
- [ ] 测试记忆系统的搜索功能

---

## 5. 技术方案

### 5.1 技术栈

- **前端**: Next.js 15 + React 19 + TypeScript + Tailwind CSS v4
- **后端**: Next.js API Routes  
- **AI LLM**: DeepSeek API (OpenAI 兼容格式)
- **AI Embedding**: 硅基流动 SiliconFlow - BAAI/bge-m3 (1024维)
- **RAG 系统**: LightRAG (统一的向量检索 + 知识图谱方案)
- **数据库**: PostgreSQL + pgvector
- **部署**: Vercel (前端) + 本地 (LightRAG 服务)
- **CI/CD**: GitHub Actions

### 5.2 架构设计

```
用户界面 (Next.js)
    ↓
API Routes
    ↓
AI 服务层 (Claude API)
    ↓
记忆系统 (向量数据库)
    ├── 人物卡
    ├── 伏笔列表
    ├── 世界观设定
    └── 章节历史
### 5.3 关键技术决策

- **决策 1**: 使用 LightRAG 统一 RAG 方案
  - 理由: LightRAG 结合了向量检索和知识图谱,提供双层检索(local + global),比单独使用 pgvector 或 GraphRAG 更强大
  - 优势: 自动提取实体和关系,支持多种查询模式,与 PostgreSQL 集成良好

- **决策 2**: 使用 DeepSeek API 而非 Claude/OpenAI
  - 理由: DeepSeek 价格极低(¥1-2/百万tokens),质量优秀,支持 OpenAI 兼容格式
  - 优势: 成本可控,适合个人项目长期使用

- **决策 3**: 使用硅基流动 bge-m3 Embedding
  - 理由: 多语言支持,1024维向量,价格实惠,OpenAI 兼容格式
  - 优势: 中文效果好,集成简单

- **决策 4**: 分章节生成而非一次性生成
  - 理由: 质量可控,可以逐章审核和调整
  - 理由: 质量可控,可以逐章审核和调整

### 5.4 记忆系统设计

#### 数据结构

```typescript
// 人物卡
interface Character {
  id: string;
  name: string;
  description: string;
  personality: string;
  abilities: string[];
  status: 'alive' | 'dead' | 'unknown';
  firstAppearance: number; // 章节号
  lastAppearance: number;
}

// 伏笔
interface Foreshadowing {
  id: string;
  content: string;
  plantedChapter: number; // 埋下伏笔的章节
  plannedRevealChapter: number; // 计划揭穿的章节
  revealed: boolean;
  revealedChapter?: number; // 实际揭穿的章节
}

// 世界观设定
interface WorldSetting {
  id: string;
  category: 'rule' | 'geography' | 'history' | 'magic';
  content: string;
  relatedChapters: number[];
}

// 章节
interface Chapter {
  id: string;
  number: number;
  title: string;
  content: string;
  outline: string;
  createdAt: Date;
  reviewResult?: ReviewResult;
}
```

---

## 6. 开发里程碑

### Milestone 1: MVP (预计 4 周)

- [ ] Week 1: 搭建项目基础架构
  - Next.js 项目初始化
  - PostgreSQL + pgvector 配置
  - Claude API 集成

- [ ] Week 2: 实现记忆系统
  - 数据模型设计
  - CRUD API
  - 向量搜索功能

- [ ] Week 3: 实现核心创作流程
  - 交互式设定创建
  - 分章节生成
  - 毒舌编辑审核

- [ ] Week 4: 测试和优化
  - E2E 测试
  - 一致性测试(生成 10 章)
  - 部署到 Vercel

### Milestone 2: 完整版 (预计 2 周)

- [ ] Week 5: 章节修订和版本管理
- [ ] Week 6: 导出功能和统计分析

---

## 7. 风险和挑战

### 7.1 技术风险

- **风险 1**: 向量数据库的语义搜索质量不够好
  - 缓解措施: 结合结构化查询,提供手动搜索功能

- **风险 2**: Claude API 成本过高
  - 缓解措施: 优化 prompt,减少不必要的 API 调用

- **风险 3**: 生成的内容质量不稳定
  - 缓解措施: 多次生成,让用户选择最好的版本

### 7.2 业务风险

- **风险 1**: 即使有记忆系统,AI 仍然可能出现一致性问题
  - 缓解措施: 毒舌编辑审核 + 人工最终审核

- **风险 2**: 50 万字的目标过于庞大
  - 缓解措施: 先验证 10 章(3 万字)的质量,再决定是否继续

---

## 8. 成功指标

- **指标 1**: 能够生成 10 章(3 万字)且人物状态保持一致
- **指标 2**: 毒舌编辑能够检测出 80% 以上的一致性问题
- **指标 3**: 用户(作者本人)愿意继续使用该工具创作
- **指标 4**: 生成的内容质量达到"可读"标准(无明显逻辑错误)

---

## 9. 参考资料

- [Claude API 文档](https://docs.anthropic.com/)
- [pgvector 文档](https://github.com/pgvector/pgvector)
- [起点中文网](https://www.qidian.com/) - 网文质量参考

---

## 10. 变更记录

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|----------|------|
| 2026-01-22 | v1.0 | 初始版本,完成第一性原理分析和需求定义 | Claude + Happy |
